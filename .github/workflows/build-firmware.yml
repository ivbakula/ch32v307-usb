name: BUILD_FIRMWARE

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: get toolchain
      run:  wget https://github.com/xpack-dev-tools/riscv-none-embed-gcc-xpack/releases/download/v10.2.0-1.2/xpack-riscv-none-embed-gcc-10.2.0-1.2-linux-x64.tar.gz
    - name: prepare
      run: tar -xvf xpack-riscv-none-embed-gcc-10.2.0-1.2-linux-x64.tar.gz
    - name: set up environment
      run: export PATH=$PATH:$(pwd)/xpack-riscv-none-embed-gcc-10.2.0-1.2-linux-x64/bin
    - name: check the environment 
      run: echo $PATH
    - name: print working directory
      run: pwd
    - name: configure -DCMAKE_C_COMPILER=$(pwd)/xpack-riscv-none-embed-gcc-10.2.0-1.2-linux-x64/bin/riscv-none-embed-gcc -DCMAKE_ASM_COMPILER=$(pwd)/xpack-riscv-none-embed-gcc-10.2.0-1.2-linux-x64/bin/riscv-none-embed-gcc
      run: cmake .
    - name: make
      run: make
